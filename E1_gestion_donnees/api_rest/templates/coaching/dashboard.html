{% extends 'core/base.html' %}
{% load static %}

{% block title %}Dashboard Coaching{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>üèãÔ∏è Dashboard Coaching</h1>
        <p>Vue d'ensemble de votre entra√Ænement et progression</p>
    </div>

    <div class="dashboard-grid">
        <!-- Plans d'entra√Ænement -->
        <div class="dashboard-card">
            <h2>üìã Plans d'entra√Ænement</h2>
            {% if active_plans %}
                <div class="plans-list">
                    {% for plan in active_plans %}
                        <div class="plan-item">
                            <h3>{{ plan.name }}</h3>
                            <p>{{ plan.description|truncatewords:15 }}</p>
                            <div class="plan-meta">
                                <span>{{ plan.duration_weeks }} semaines</span>
                                <span>{{ plan.sessions_per_week }} s√©ances/semaine</span>
                            </div>
                            <a href="{% url 'coaching:plan_detail' plan.pk %}" class="btn btn-primary">Voir le plan</a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Aucun plan actif</p>
                    <a href="{% url 'coaching:running_wizard' %}" class="btn btn-primary">Cr√©er un plan</a>
                </div>
            {% endif %}
        </div>

        <!-- Objectifs -->
        <div class="dashboard-card">
            <h2>üéØ Objectifs</h2>
            {% if active_goals %}
                <div class="goals-list">
                    {% for goal in active_goals %}
                        <div class="goal-item">
                            <h3>{{ goal.name }}</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ goal.progress_percentage }}%"></div>
                            </div>
                            <div class="goal-meta">
                                <span>{{ goal.progress_percentage }}% accompli</span>
                                {% if goal.target_date %}
                                    <span>√âch√©ance: {{ goal.target_date|date:"d/m/Y" }}</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Aucun objectif d√©fini</p>
                    <a href="{% url 'coaching:quick_goal' %}" class="btn btn-primary">D√©finir un objectif</a>
                </div>
            {% endif %}
        </div>

        <!-- Sessions √† venir -->
        <div class="dashboard-card">
            <h2>üìÖ Prochaines s√©ances</h2>
            {% if upcoming_sessions %}
                <div class="sessions-list">
                    {% for session in upcoming_sessions %}
                        <div class="session-item">
                            <div class="session-date">{{ session.planned_date|date:"d/m" }}</div>
                            <div class="session-details">
                                <h4>{{ session.name }}</h4>
                                <p>{{ session.session_type|title }}</p>
                                {% if session.planned_duration %}
                                    <span>{{ session.planned_duration }} min</span>
                                {% endif %}
                                {% if session.planned_distance %}
                                    <span>{{ session.planned_distance }} km</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Aucune s√©ance planifi√©e</p>
                </div>
            {% endif %}
        </div>

        <!-- Sessions r√©centes -->
        <div class="dashboard-card">
            <h2>üìä Sessions r√©centes</h2>
            {% if recent_sessions %}
                <div class="sessions-list">
                    {% for session in recent_sessions %}
                        <div class="session-item">
                            <div class="session-status {{ session.status }}"></div>
                            <div class="session-details">
                                <h4>{{ session.name }}</h4>
                                <p>{{ session.updated_at|date:"d/m/Y" }}</p>
                                <span class="status-badge {{ session.status }}">{{ session.get_status_display }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Aucune s√©ance r√©cente</p>
                </div>
            {% endif %}
        </div>

        <!-- M√©triques de performance -->
        {% if latest_metrics %}
        <div class="dashboard-card">
            <h2>üìà M√©triques de performance</h2>
            <div class="metrics-grid">
                {% if latest_metrics.vma %}
                    <div class="metric-item">
                        <span class="metric-label">VMA</span>
                        <span class="metric-value">{{ latest_metrics.vma }} km/h</span>
                    </div>
                {% endif %}
                {% if latest_metrics.vo2_max %}
                    <div class="metric-item">
                        <span class="metric-label">VO2 Max</span>
                        <span class="metric-value">{{ latest_metrics.vo2_max }}</span>
                    </div>
                {% endif %}
                {% if latest_metrics.form %}
                    <div class="metric-item">
                        <span class="metric-label">Forme</span>
                        <span class="metric-value">{{ latest_metrics.form }}/100</span>
                    </div>
                {% endif %}
            </div>
            <small>Derni√®re mise √† jour: {{ latest_metrics.calculation_date|date:"d/m/Y" }}</small>
        </div>
        {% endif %}
    </div>

    <!-- Actions rapides -->
    <div class="quick-actions">
        <h2>üöÄ Actions rapides</h2>
        <div class="actions-grid">
            <a href="{% url 'coaching:running_wizard' %}" class="action-card">
                <div class="action-icon">üéØ</div>
                <h3>Nouvel objectif</h3>
                <p>Cr√©er un plan personnalis√©</p>
            </a>
            <a href="{% url 'coaching:quick_goal' %}" class="action-card">
                <div class="action-icon">‚ö°</div>
                <h3>Objectif rapide</h3>
                <p>D√©finir un objectif simple</p>
            </a>
            <a href="{% url 'coaching:plan_list' %}" class="action-card">
                <div class="action-icon">üìã</div>
                <h3>Mes plans</h3>
                <p>Voir tous vos plans</p>
            </a>
        </div>
    </div>
</div>

<style>
.dashboard-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
.dashboard-header { text-align: center; margin-bottom: 30px; }
.dashboard-header h1 { color: #2c3e50; margin-bottom: 10px; }

.dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px; }
.dashboard-card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.dashboard-card h2 { color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; }

.plan-item, .goal-item, .session-item { padding: 15px 0; border-bottom: 1px solid #ecf0f1; }
.plan-item:last-child, .goal-item:last-child, .session-item:last-child { border-bottom: none; }

.plan-meta, .goal-meta { display: flex; gap: 15px; margin: 10px 0; font-size: 0.9em; color: #7f8c8d; }

.progress-bar { background: #ecf0f1; height: 8px; border-radius: 4px; margin: 10px 0; }
.progress-fill { background: #3498db; height: 100%; border-radius: 4px; transition: width 0.3s; }

.session-item { display: flex; align-items: center; gap: 15px; }
.session-date { background: #3498db; color: white; padding: 8px 12px; border-radius: 6px; font-weight: 500; }
.session-details h4 { margin: 0 0 5px 0; }
.session-status { width: 12px; height: 12px; border-radius: 50%; }
.session-status.completed { background: #27ae60; }
.session-status.planned { background: #f39c12; }
.session-status.skipped { background: #e74c3c; }

.metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; }
.metric-item { text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px; }
.metric-label { display: block; font-size: 0.9em; color: #7f8c8d; margin-bottom: 5px; }
.metric-value { display: block; font-size: 1.5em; font-weight: 600; color: #2c3e50; }

.empty-state { text-align: center; padding: 30px; color: #7f8c8d; }

.quick-actions { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
.action-card { display: block; text-decoration: none; color: inherit; padding: 20px; border: 2px solid #ecf0f1; border-radius: 8px; text-align: center; transition: all 0.3s; }
.action-card:hover { border-color: #3498db; transform: translateY(-2px); }
.action-icon { font-size: 2em; margin-bottom: 10px; }
.action-card h3 { margin: 10px 0 5px 0; color: #2c3e50; }
.action-card p { color: #7f8c8d; margin: 0; }

.btn { padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 6px; display: inline-block; transition: background 0.3s; }
.btn:hover { background: #2980b9; }
.status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; }
.status-badge.completed { background: #d5edda; color: #155724; }
.status-badge.planned { background: #fff3cd; color: #856404; }
.status-badge.skipped { background: #f8d7da; color: #721c24; }
</style>
{% endblock %}