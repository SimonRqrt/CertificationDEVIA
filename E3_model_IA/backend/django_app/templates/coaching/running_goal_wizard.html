{% extends 'core/base.html' %}
{% load static %}

{% block title %}Assistant Objectifs Running{% endblock %}

{% block content %}
<div class="container">
    <div class="wizard-header">
        <h1>üéØ Assistant Objectifs Running</h1>
        <p>D√©finissez votre objectif et obtenez un plan d'entra√Ænement personnalis√©</p>
        
        <!-- Barre de progression -->
        <div class="progress-bar">
            <div class="step {% if current_step >= 1 %}active{% endif %}">1. Profil</div>
            <div class="step {% if current_step >= 2 %}active{% endif %}">2. Objectif</div>
            <div class="step {% if current_step >= 3 %}active{% endif %}">3. Pr√©f√©rences</div>
            <div class="step {% if current_step >= 4 %}active{% endif %}">4. G√©n√©ration</div>
        </div>
    </div>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="wizard-content">
        {% if current_step == 1 %}
            <!-- √âtape 1: Informations personnelles -->
            <div class="step-content">
                <h2>üìù Informations personnelles</h2>
                <p>Renseignez vos informations pour personnaliser votre plan.</p>
                
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="step" value="1">
                    
                    {% if personal_form %}
                        {{ personal_form.as_p }}
                    {% endif %}
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Suivant ‚Üí</button>
                    </div>
                </form>
            </div>

        {% elif current_step == 2 %}
            <!-- √âtape 2: Objectif running -->
            <div class="step-content">
                <h2>üèÉ Objectif running</h2>
                <p>Quel est votre objectif de course ?</p>
                
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="step" value="2">
                    
                    {% if goal_form %}
                        {{ goal_form.as_p }}
                    {% endif %}
                    
                    <div class="form-actions">
                        <a href="?step=1" class="btn btn-secondary">‚Üê Pr√©c√©dent</a>
                        <button type="submit" class="btn btn-primary">Suivant ‚Üí</button>
                    </div>
                </form>
            </div>

        {% elif current_step == 3 %}
            <!-- √âtape 3: Pr√©f√©rences -->
            <div class="step-content">
                <h2>‚öôÔ∏è Pr√©f√©rences d'entra√Ænement</h2>
                <p>Personnalisez votre plan selon vos disponibilit√©s.</p>
                
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="step" value="3">
                    
                    {% if preferences_form %}
                        {{ preferences_form.as_p }}
                    {% endif %}
                    
                    <div class="form-actions">
                        <a href="?step=2" class="btn btn-secondary">‚Üê Pr√©c√©dent</a>
                        <button type="submit" class="btn btn-primary">Suivant ‚Üí</button>
                    </div>
                </form>
            </div>

        {% elif current_step == 4 %}
            <!-- √âtape 4: G√©n√©ration du plan -->
            <div class="step-content">
                <h2>ü§ñ G√©n√©ration de votre plan</h2>
                <p>Cr√©ation de votre plan d'entra√Ænement personnalis√© avec l'IA.</p>
                
                {% if session_data %}
                    <div class="summary">
                        <h3>R√©sum√© de votre demande :</h3>
                        <ul>
                            {% if session_data.running_goal %}
                                <li><strong>Objectif :</strong> {{ session_data.running_goal.race_type|default:"Running" }}</li>
                                {% if session_data.running_goal.target_time %}
                                    <li><strong>Temps vis√© :</strong> {{ session_data.running_goal.target_time }}</li>
                                {% endif %}
                            {% endif %}
                            {% if session_data.training_preferences %}
                                <li><strong>S√©ances/semaine :</strong> {{ session_data.training_preferences.sessions_per_week|default:"3" }}</li>
                                <li><strong>Niveau :</strong> {{ session_data.training_preferences.current_level|default:"Interm√©diaire" }}</li>
                            {% endif %}
                        </ul>
                    </div>
                {% endif %}
                
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="step" value="4">
                    
                    {% if generation_form %}
                        {{ generation_form.as_p }}
                    {% endif %}
                    
                    <div class="form-actions">
                        <a href="?step=3" class="btn btn-secondary">‚Üê Pr√©c√©dent</a>
                        <button type="submit" class="btn btn-success">üöÄ G√©n√©rer mon plan</button>
                    </div>
                </form>
                
                {% if error %}
                    <div class="alert alert-error">
                        <strong>Erreur :</strong> {{ error }}
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>

    <!-- Sidebar avec infos contextuelles -->
    <div class="sidebar">
        {% if recent_activities %}
            <div class="info-panel">
                <h3>üìä Vos activit√©s r√©centes</h3>
                <ul>
                    {% for activity in recent_activities|slice:":5" %}
                        <li>
                            {{ activity.activity_name }} - {{ activity.distance_km }}km
                            <small>({{ activity.start_time|date:"d/m" }})</small>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if active_goals %}
            <div class="info-panel">
                <h3>üéØ Objectifs actuels</h3>
                <ul>
                    {% for goal in active_goals %}
                        <li>{{ goal.name }} ({{ goal.progress_percentage }}%)</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if active_plans %}
            <div class="info-panel">
                <h3>üìã Plans actifs</h3>
                <ul>
                    {% for plan in active_plans %}
                        <li>{{ plan.name }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>
</div>

<style>
.container { display: flex; max-width: 1200px; margin: 0 auto; padding: 20px; gap: 30px; }
.wizard-content { flex: 2; }
.sidebar { flex: 1; }

.wizard-header { text-align: center; margin-bottom: 30px; }
.wizard-header h1 { color: #2c3e50; margin-bottom: 10px; }

.progress-bar { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
.step { padding: 8px 16px; background: #ecf0f1; border-radius: 20px; color: #7f8c8d; }
.step.active { background: #3498db; color: white; }

.step-content { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.step-content h2 { color: #2c3e50; margin-bottom: 15px; }

.form-actions { margin-top: 30px; display: flex; gap: 15px; justify-content: flex-end; }
.btn { padding: 12px 24px; border: none; border-radius: 6px; text-decoration: none; cursor: pointer; }
.btn-primary { background: #3498db; color: white; }
.btn-secondary { background: #95a5a6; color: white; }
.btn-success { background: #27ae60; color: white; }

.summary { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
.alert { padding: 15px; border-radius: 6px; margin: 15px 0; }
.alert-error { background: #e74c3c; color: white; }

.info-panel { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
.info-panel h3 { margin-bottom: 15px; color: #2c3e50; }
.info-panel ul { list-style: none; padding: 0; }
.info-panel li { padding: 8px 0; border-bottom: 1px solid #ecf0f1; }
.info-panel small { color: #7f8c8d; }
</style>
{% endblock %}